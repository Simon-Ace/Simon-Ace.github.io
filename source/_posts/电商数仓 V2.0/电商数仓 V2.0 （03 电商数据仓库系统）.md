---
type: blog
title: 电商数仓 V2.0 （03 电商数据仓库系统）
date: 2021-01-24
categories: 教程
tags: 数仓
cover: false
meta:
  date: false
---

# 电商数仓 V2.0 （03 电商数据仓库系统）

## 一、数仓分层

### 1.1 为什么要分层

- 把复杂问题简单化
  - 将复杂的任务分解成多层来完成，每一层只处理简单的任务，方便定位问题
- 减少重复开发
  - 规范数据分层，通过的中间层数据，能够减少极大的重复计算，增加一次计算结果的复用性
- 隔离原始数据
  - 不论是数据的异常还是数据的敏感性，使真实数据与统计数据解耦开

**常见分层方式：**

![image-20210124094731145](https://raw.githubusercontent.com/shuopic/ImgBed/master/NoteImgs/image-20210124094731145.png)

### 1.2 数据集市与数据仓库

**数据仓库：**企业级别的，包含企业内所有的数据

**数据集市：**可以理解为部门级别的，归属于数据仓库



## 二、数仓理论简介

### 2.1 范式理论

**定义**

范式可以理解为设计一张数据表的表结构，符合的标准级别，规范和要求

**优点**

- 减少数据冗余
- 保持数据一致性（只改其中一张表就可以了）

**缺点**

- 难以应对大数据量的计算，因为会频繁涉及表之间的 join 操作

### 2.2 关系建模和维度建模

**数据处理主要分类：**

- 联机事务处理 OLTP（on-line transaction processing）
  - 基于事务型的数据增删改查，如银行交易
- 联机分析处理 OLAP（On-Line Analytical Processing）
  - 基于分析型的数据处理，如计算pv uv

| 对比属性 | OLTP（如 MySQL）    | OLAP（如 Hive）     |
| ------------------ | -------------------------- | -------------------------- |
| 读特性   | 每次查询只返回少量记录     | 对大量记录进行汇总         |
| 写特性   | 随机、低延时写入用户的输入 | 批量导入                   |
| 使用场景 | 用户，Java EE项目          | 内部分析师，为决策提供支持 |
| 数据表征 | 最新数据状态               | 随时间变化的历史状态       |
| 数据规模 | GB                         | TB到PB                     |

#### 2.2.1 关系建模

- 基本严格遵循三范式
- 表较为零碎
- 数据冗余低

<img src="https://raw.githubusercontent.com/shuopic/ImgBed/master/NoteImgs/image-20210124113305858.png" alt="image-20210124113305858" style="zoom:67%;" />

#### 2.2.2 维度建模

- 主要应用于OLAP系统中
- 通常以某一个事实表为中心进行表的组织，主要面向业务
- 存在数据的冗余，但是能方便的得到数据。
- 在大规模数据，跨表分析统计查询过程中，不需要多表关联，提升效率
- 把相关各种表整理成两种：事实表和维度表

<img src="https://raw.githubusercontent.com/shuopic/ImgBed/master/NoteImgs/image-20210124113451765.png" alt="image-20210124113451765" style="zoom:50%;" />

**分类**

- 星型模型
  - 在一个事实表周围只会围绕一圈维度表
  - 冗余可能会多一点，但是减少了 join 能提升计算效率
  - <img src="https://raw.githubusercontent.com/shuopic/ImgBed/master/NoteImgs/image-20210124114249379.png" alt="image-20210124114249379" style="zoom:33%;" />
- 雪花模型
  - 相对于星型模型，事实表周围会有多层维度表
  - 会更灵活一些
  - <img src="https://raw.githubusercontent.com/shuopic/ImgBed/master/NoteImgs/image-20210124114305334.png" alt="image-20210124114305334" style="zoom:33%;" />
- 星座模型
  - 在前两种上的扩展，如果多于一个事实表，就是星座模型
  - <img src="https://raw.githubusercontent.com/shuopic/ImgBed/master/NoteImgs/image-20210124114351218.png" alt="image-20210124114351218" style="zoom:33%;" />

### 2.3 维度表和事实表

#### 2.3.1 维度表

**定义：**

一般是对事实的***描述信息***。每一张维表对应现实世界中的一个对象或者概念。   例如：用户、商品、日期、地区等

**特征：**

- 维表的范围很宽（具有多个属性、列比较多）

- 跟事实表相比，行数相对较小：通常< 10万条

- 内容相对固定：编码表

#### 2.3.2 事实表

**定义：**

描述一个业务过程，如下单、支付、退款、评价等。通常包含着可统计的列，如金额、数量等。

**特征：**

- 非常的大

- 内容相对的窄：列数较少

- 经常发生变化，每天会新增加很多

**事实表分类：**

**1）事务型事实表**

以*每个事务或事件为单位*，例如一个销售订单记录，一笔支付记录等，作为事实表里的一行数据。一旦事务被提交，事实表数据被插入，数据就不再进行更改，其更新方式为增量更新。  

**2）周期型快照事实表**

周期型快照事实表中*不会保留所有数据，只保留固定时间间隔的数据*，例如每天或者每月的销售额。对中间过程不敏感，只关心到一个时间点时的状态。

**3）累积型快照事实表**

*累计快照事实表用于跟踪业务事实的变化。*例如，数据仓库中可能需要累积或者存储订单从下订单开始，到订单商品被打包、运输、和签收的各个业务阶段的时间点数据来跟踪订单声明周期的进展情况。当这个业务过程进行时，事实表的记录也要不断更新。